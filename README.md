# jetson_facerecognition
Face recognition on jetson Nano
## Описание устройства.
Выполнена работа по применению устройства **Jetson Nano jetpack 4.6.1** на базе операционной системы Ubuntu 20.04. Была выбрана модель для детекции лиц face_recognition, [вот здесь](https://github.com/ageitgey/face_recognition) описание. Выбрана модель не случайно, так как модель на фреймворке tensorflow запустить у меня не удалось. Устройство jetson nano 4 Gb RAM 128 ядер gpu но и эта модель face_recognition оказалась тяжела для его работы в real-time. Для того чтоб детекция и изображение не тормозило мне пришлось изменять размер изображения в 5 раз. Здесь написан pipeline для gstreamer, чтоб открыть изображение из камеры. Камера CSI mipi с драйвером imx219 Sony. Такая же применяется на Raspberry Pi.
## Описание проекта.
Идея лежит в основе свой-чужой, где-то на входе будет камера и по лицу определять есть ли этот человек, верней его лицо, скажем в базе. Здесь реализовано что все имена и ембединги лиц сохраненных людей сохранены в csv файле. На изображении будет написано имя человека если он сохранен или если нет будет написано 'Unknow'. Также, реализован метод класса для добавления лица и имени человека и также метод удаления из сохраненных его данных. Проверяется при сохранении есть ли уже этот человек в сохраненных или нет. Если человек распознан как существующий, то рамка вокруг лица отображается зеленым цветом, если нет то красным. Не важно сколько людей попадет в видеокамеру на изображении будет все равно распознано, кто есть в базе кого нет.
## Применение
Входим в операционную систему на устройстве Jetson, открываем командную строку и вводим команду

`git clone https://github.com/Andrey-Mel/jetson_facerecognition.git`

`cd jetson_facerecognition`

В файле `requirements.txt` написаны библиотеки, которые применялись для проекта. Все их устанавливать не придется если в карту памяти установите образ системы для работы устройства, [брал отсюда образ](https://github.com/Qengineering/Jetson-Nano-image), единственное что нужно установить это саму модель face_recognition, устанавливается командой `pip3 install face-recognition`, ссылка сверху. Образ с библиотеками я решил устанавливать, потому что если это делать на пустой системе, то это занимает очень много времени. Например фреймворк tensorflow устанавливается 61 час. Это описано на [официальном сайте](https://www.nvidia.com/en-us/autonomous-machines/embedded-systems/jetson-nano.../).

Даже если вы работаете с предустановленным образом всеравно можете запустить команду:
`pip3 install -r requirements.txt` установится модель face-recognition.

Когда все установлено запускаем изображение командой (это все делается в ос на jetson nano)

`python3 camera_app.py --video`

Запустится видео с распознаванием лиц, и скорее всего вас система будет распознавать как "Unknow". 
**Для выхода из видео нужно нажать клавишу 'q' или клавишу 'Esc'**

Выходим из видео, описано выше, стоим или сидим перед камерой, чтоб сохранить эмбединг лица, ввод команды

`python3 camera_app.py --photo имя` 

где, "имя" - пишем имя человека.

Затем запускаем опять видео и смотрим, что лицо должно быть отрисовано зеленой рамкой с именем.

Удалить лицо из сохраненных:

`python3 camera_app.py --delete_face имя`

Теперь в сохраненных не будет этого лица и рамка будет красной с надписью "Unknow".
Таким образом проект и носит смысл "свой-чужой". Еще важный момент, детекция лица происходит на растоянии до 1 метра.
От того с чем я столкнулся, можно сделать улучшения этого проекта:

> во-первых применить одностадийную модель типа Yolo. Она работает быстрей в real-time.

> во-вторых она масштабируется, попробовать ее перевести в формат TensorRT, она написана на pytorch и ее можно масштабировать даже из коробки. Эта модель, которая применена в этом проекте, она находится в репозитории уже в двоичном файле и масштабировать ее это не тривиальная задача.

## Вывод:
Эта идея проекта носит практический характер, ее можно применять где-то на входе предприятия, например когда пришел человек на работу, или также является ли этот человек сотрудником предприятия. Еще, если установить камеры на территории предприятия на высоте уровня лица, и проверять, не находится ли посторонний человек на территории.
